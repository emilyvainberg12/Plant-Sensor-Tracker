<!DOCTYPE html>
<html>
	<head>
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
		<title>Plant Sitter</title>
	</head>
	<style>
		/* Style The Dropdown Button */
		.dropbtn {
		  background-color: lightblue;
		  color: white;
		  padding: 16px;
		  font-size: 16px;
		  border: none;
		  cursor: pointer;
		}
		
		/* The container <div> - needed to position the dropdown content */
		.dropdown {
		  position: relative;
		  display: inline-block;
		}
		
		/* Dropdown Content (Hidden by Default) */
		.dropdown-content {
		  display: none;
		  position: absolute;
		  background-color: #f9f9f9;
		  min-width: 160px;
		  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
		  z-index: 1;
		}
		
		/* Links inside the dropdown */
		.dropdown-content a {
		  color: black;
		  padding: 12px 16px;
		  text-decoration: none;
		  display: block;
		}
		
		/* Change color of dropdown links on hover */
		.dropdown-content a:hover {background-color: #f1f1f1}
		
		/* Show the dropdown menu on hover */
		.dropdown:hover .dropdown-content {
		  display: block;
		}
		
		/* Change the background color of the dropdown button when the dropdown content is shown */
		.dropdown:hover .dropbtn {
		  background-color: lightblue;
		}
		.table, th, td {
			text-align: center;
			border: 1px solid;
			width: 500px;
			height: 40px;
		}
		</style>

	<body>
		<center>
		<h1>Plant Sitter</h1>

		</center>
		<br> <br>
		<caption style="font-weight: bold">Your Plants: </caption>
		<table id="plants">
			<tr>
				<th id="test">Plant Name </th>
				<th>Recommened Water </th>
				<th>Recommended Light </th>
				<!-- <th> Next Time to Water </th> -->
			</tr>
		</table>
		<br> <br>
		<label for="plants">Current Plant to Track: </label>
		<select name="plantSelect" id="plantSelect">
			<option value="Mint Leaf">Mint</option>
			<option value="Orchid">Orchid</option>
			<option value="Cactus">Cactus</option>
		</select>
		<button id="addPlant">Choose</button>
		<br><br>

		<div id="charts">
		<canvas id="water" style="width:100%;max-width:500px; height:300px"></canvas>
		<br>
		<br>
		<canvas id="light" style="width:100%;max-width:500px; height:300px"></canvas>
		<br>
		<br>
		</div>

		<script>
			let moisture = 0;
			let light = 0;
			var xValuesLight = ["M- Light", "T- Light", "W- Light", "Th- Light","F- Light", "Sa- Light", "Su- Light"];
			var xValuesWater = ["M- Moisture", "T- Moisture", "W- Moisture",  "Th- Moisture", "F- Moisture", "Sa- Moisture", "Su- Moisture"];
			var yValuesLight = [];
			var yValuesWater = [];
			PlantInformation = [["Mint Leaf", "7 day a week", "indoor shade", "Tomorrow"],["Orchid", "1 day a week", "indoor sun", "Friday"], 
			["Cactus", "2 time a month", "outdoor sun", "Monday 21st"]]
			// first array is the light values
			// second array is the moisture values 
			PlantLineValues = {"Mint Leaf": [[400,400,400,400,400,400,400], [5, 5, 5, 5, 5, 5, 5]], "Orchid": [[400,400,400,400,400,400,400], [5, 5, 5, 5, 5, 5, 5]], "Cactus": [[400,400,400,400,400,400,400], [5, 5, 5, 5, 5, 5, 5]]};
	
			for (var i = 0; i < PlantInformation.length; i++){
				var t = "";
				var tr = "<tr>";
				tr += "<td>"+PlantInformation[i][0]+"</td>";
				tr += "<td>"+PlantInformation[i][1]+"</td>";
				tr += "<td>"+PlantInformation[i][2]+"</td>";
				// tr += "<td>"+PlantInformation[i][3]+"</td>";
				tr += "</tr>";
				t += tr;
				document.getElementById("plants").innerHTML += t;
			}

			//Update saved_plants upon clicking ADD button
			let plantBtn = document.getElementById("addPlant");
			let myPlant = ""
			function addPlant() {
				myPlant = document.getElementById("plantSelect").value
				addData(null)
				addChart(myPlant)
			}
			plantBtn.addEventListener('click', addPlant);

			async function load(url) {
				let obj = null;
				try {
					obj = await (await fetch(url)).json();
				} catch(e) {
					console.log('error');
				}
				console.log(obj);
			}

			fetch("http://192.168.40.40/ellie")
				.then((response) => response.json())
				.then((data) => addData(data))
				.then((data) => console.log(data));

			// addData(null)	
			
			function addData(data){
				//TODO: replace myDictionary with DATA bc info needs to be recived from launchpad: should be same format  
				myDictionary = {'moisture': [5, 6, 4, 8, 9, 5, 5, 5], 'light':[620, 640, 450, 630, 660,610,624,540]}
				console.log("here")
				// console.log(data)
				moistureArray = myDictionary['moisture']
				lightArray = myDictionary['light']
				console.log(yValuesWater)
				console.log(moistureArray)
				console.log(lightArray)
				for (var x = 0; x < moistureArray.length; x++) {
					console.log(moistureArray[x])
					yValuesWater.push(moistureArray[x])
				}
				for (var x = 0; x < lightArray.length; x++) {
					yValuesLight.push(lightArray[x])
				}
			}		

			var barColors = ["red", "red", "green", "green","blue", "blue", "orange", "orange","brown", "brown", "pink", "pink", "yellow", "yellow"];

			function addChart(myPlant){
				var currentChart1 = "water"
				var currentChart2 = "light"
				new Chart(currentChart1, {
				type: "bar",
				data: { 
					labels: xValuesLight,
					datasets: [{
						type: 'bar',
						backgroundColor: 'orange',
						data: yValuesLight
					},{
						type: 'line',
						data : PlantLineValues[myPlant][0],
						borderColor: 'lightgreen',
						fill: false
					},
					]
					},
				options: {
					legend: {display: false},
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					},
					title: {
						display: true,
						text: "Light Data for Plant: " + myPlant
					},
					chartArea: {
						backgroundColor: 'rgb(75, 192, 192)',
					}
				}
				});
				new Chart(currentChart2, {
				type: "bar",
				data: {
					labels: xValuesWater,
					datasets: [{
						backgroundColor: 'lightblue',
						data: yValuesWater
					},
					{
						type: 'line',
						data : PlantLineValues[myPlant][1],
						borderColor: 'lightgreen',
						fill: false
					},
					]
					},
				options: {
					legend: {display: false},
					scales: {
						yAxes: [{
							ticks: {
								beginAtZero: true
							}
						}]
					},
					title: {
						display: true,
						text: "Moisture Data for Plant: " + myPlant
					},
					chartArea: {
						backgroundColor: 'rgb(75, 192, 192)',
					}
				}
				});
				// add bar values for chosen plant 
			}
		</script>
	</body>

<script src="https://d3js.org/d3.v7.min.js"></script>

<script type="application/javascript">
	const SERVERADDRESS = "http://127.0.0.1:3000"
	// use XML HTTP request to grab data from the server (central)
	let xmlhttp = new XMLHttpRequest()

	startTime = new Date();
	xmlhttp.onreadystatechange = function () {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			let responseText = xmlhttp.responseText
			moisture = parseFloat(JSON.parse(responseText).moisture);
			light = parseFloat(JSON.parse(responseText).light);
		}
	}
</script>

</html>
